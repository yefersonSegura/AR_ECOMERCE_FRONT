<div class="grid card">
    <div class="col-12 md:col-12 layout-main-content-header">
        <h5>
            Empleados
        </h5>
    </div>
    <div class="col-12 md:col-12">
        <p-toolbar>
            <div class="p-toolbar-group-left">
                <button pButton type="button" label="Nuevo" icon="fa fa-floppy-o" class="p-button-link mr:col-2"
                    (click)="visible=true;"></button>
            </div>
        </p-toolbar>
    </div>
    <div class="col-12 md:col-12 mt-3">
        <p-table [value]="employees" [columns]="cols" styleClass="p-datatable-sm" [paginator]="false" [lazy]="false"
            [loading]="loading" [responsive]="true" scrollHeight="460px" [scrollable]="true"
            [showCurrentPageReport]="false" dataKey="employeeID">
            <ng-template pTemplate="header" let-columns>
                <tr>
                    @for(col of columns;track col.field){
                    <th
                        [ngStyle]="{'text-align':col.align,'width':col.width,'display': col.display,'min-width':col.minWidth, 'max-width':col.maxWidth}">
                        {{col.header}}
                    </th>
                    }
                    <th style="width: 150px;">
                        Acciones
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
                <tr [pSelectableRow]="rowData">
                    @for(col of columns;track col?.id){
                    <td class="table-cell-word-wrap"
                        [ngStyle]="{'text-align':col.align, 'width':col.width,'display':col.display,'min-width':col.minWidth, 'max-width':col.maxWidth}">
                        @if(!( col.type === 'date'|| col.type === 'serie'|| col.type === 'money')){
                        <span>
                            {{rowData[col.field]}}
                        </span>
                        }
                        @if(col.type === 'date'){
                        <span>
                            {{rowData[col.field] | date:col.format}}
                        </span>
                        }
                    </td>
                    }
                    <td style="width: 150px; display: flex;">
                        @if(rowData.userID==0){
                        <p-button icon="fa fa-unlock-alt" [rounded]="true" severity="info" [outlined]="true"
                            (click)="assignUser(rowData)" />
                        }@else{
                        <p-button icon="fa fa-lock" [rounded]="true" severity="info" [outlined]="true"
                            [disabled]="true" />
                        }
                        <p-button icon="fa fa-edit" [rounded]="true" severity="success" [outlined]="true" class="ml-2"
                            (click)="removeEdit(rowData)" />
                        <p-button icon="fa fa-trash" [rounded]="true" class="ml-2" severity="danger" [outlined]="true"
                            (click)="removeRow(rowData)" />
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>


<p-dialog header="Crear Nuevo Empleado" [modal]="true" [(visible)]="visible" [style]="{ width: '55rem' }">
    <span class="p-text-secondary block mb-5">Complete todos los campos.</span>
    <div class="col-12 md:col-12 mt-5">
        <div class="p-fluid grid formgrid">
            <div class="col-12 md:col-2 p-field">
                Primer Nombre:
            </div>
            <div class="col-12 md:col-4 p-field">
                <input pInputText id="firstName" class="flex-auto" [(ngModel)]="employeeModel.firstName" />
                <small class="p-error" *ngIf="submitted && !employeeModel.firstName">Campo requerido</small>
            </div>
            <div class="col-12 md:col-2 p-field">
                Segundo Nombre:
            </div>
            <div class="col-12 md:col-4 p-field">
                <input pInputText id="lastName" class="flex-auto" [(ngModel)]="employeeModel.lastName" />
                <small class="p-error" *ngIf="submitted && !employeeModel.lastName">Campo requerido</small>
            </div>
            <div class="col-12 md:col-2 mt-3 p-field">
                Email:
            </div>
            <div class="col-12 md:col-4 mt-2 p-field">
                <input pInputText id="email" class="flex-auto" [(ngModel)]="employeeModel.email" />
                <small class="p-error" *ngIf="submitted && !employeeModel.email">Campo requerido</small>
            </div>
            <div class="col-12 md:col-2 mt-2 p-field">
                Celular:
            </div>
            <div class="col-12 md:col-4 mt-2 p-field">
                <input pInputText id="phone" class="flex-auto" [(ngModel)]="employeeModel.phone" />
                <small class="p-error" *ngIf="submitted && !employeeModel.phone">Campo requerido</small>
            </div>
            <div class="col-12 md:col-2 mt-2 p-field">
                Dirección:
            </div>
            <div class="col-12 md:col-4 mt-2 p-field">
                <input pInputText id="address" class="flex-auto" [(ngModel)]="employeeModel.address" />
                <small class="p-error" *ngIf="submitted && !employeeModel.address">Campo requerido</small>
            </div>
            <div class="col-12 md:col-2 mt-2  p-field">
                Ciudad:
            </div>
            <div class="col-12 md:col-4 mt-2 p-field">
                <input pInputText id="city" class="flex-auto" [(ngModel)]="employeeModel.city" />
                <small class="p-error" *ngIf="submitted && !employeeModel.city">Campo requerido</small>
            </div>
            <div class="col-12 md:col-2 mt-2 p-field">
                País:
            </div>
            <div class="col-12 md:col-4 mt-2 p-field">
                <input pInputText id="country" class="flex-auto" [(ngModel)]="employeeModel.country" />
                <small class="p-error" *ngIf="submitted && !employeeModel.country">Campo requerido</small>
            </div>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Guardar" [outlined]="true" severity="secondary" (onClick)="saveEmployee()" />
        <p-button label="Cancelar" [text]="true" severity="secondary" (onClick)="visible = false" />
    </ng-template>
</p-dialog>
<p-dialog header="Crear Usuario" [modal]="true" [(visible)]="visibleModalUserAdmin" [style]="{ width: '27rem' }">
    <span class="p-text-secondary block mb-5">Ingrese sus credenciales.</span>
    <div class="flex align-items-center gap-3 mb-3">
        <div class="col-12 md:col-2">
            <label for="role" class="font-semibold w-6rem">Rol</label>
        </div>
        <div class="col-12 md:col-10">
            <p-dropdown [options]="roles" [(ngModel)]="userModel.roleID" optionLabel="roleName" optionValue="roleID" styleClass="w-full" />
            <small class="p-error" *ngIf="submitted && !userModel.roleID">*</small>
        </div>
    </div>
    <div class="flex align-items-center gap-3 mb-3">
        <label for="username" class="font-semibold w-6rem">Usuario</label>
        <input pInputText id="username" [(ngModel)]="userModel.userName" class="flex-auto" autocomplete="off"
            [disabled]="true" />
        <small class="p-error" *ngIf="submitted && !userModel.userName">*</small>
    </div>
    <div class="flex align-items-center gap-3 mb-5">
        <label for="password" class="font-semibold w-6rem">Contraseña</label>
        <input type="password" pInputText id="password" [(ngModel)]="userModel.password_User" class="flex-auto"
            autocomplete="off" />
        <small class="p-error" *ngIf="submitted && !userModel.password_User">*</small>
    </div>
    <div class="flex align-items-center gap-3 mb-5">
        <label for="password" class="font-semibold w-6rem">Confirmar Contraseña</label>
        <input type="password" pInputText id="password" [(ngModel)]="userModel.confirm_password_User" class="flex-auto"
            autocomplete="off" />
        <small class="p-error" *ngIf="submitted && !userModel.confirm_password_User">*</small>
    </div>
    <div class="flex justify-content-end gap-2">
        <p-button label="Crear Usuario" [loading]="loadingUserAdmin" (onClick)="saveUser()" />
        <p-button label="Cancelar" severity="secondary" (onClick)="visibleModalUserAdmin = false" />
    </div>
</p-dialog>